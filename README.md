# Neverhood patch

---

### Что делает патч:
- Исправляет проблемы совместимости с ОС начиная с Windows XP;
- Исправляет проблемы с графикой (искажение цветов, радужную палитру, мерцания);
- Исправляет тормоза видео-заставок и при перемещении от первого лица;
- Позволяет играть без CD-диска;
- Позволяет вместо реестра использовать файлы в качестве сохранений (в каталоге `saves`);
- Автоматически экспортирует сохранения из реестра в каталог `saves` при первом запуске.

---

### Установка игры и патча:
1. Создайте новый каталог, в котором будет размещена игра;
2. В созданный каталог скопируйте следующие файлы игры (с диска или другого источника):
  - nhc.exe
  - smackw32.dll
  - readme.txt
3. В каталоге игры создайте каталог `DATA` и скопируйте в него следующие файлы:
  - A.BLB
  - C.BLB
  - HD.BLB
  - I.BLB
  - M.BLB
  - S.BLB
  - T.BLB
4. Скопируйте файлы `ddraw.dll` и `nvhpatch.dll` в каталог игры;
5. Откройте свойства файла `nhc.exe`, перейдите на вкладку **`Совместимость`** и **ОТКЛЮЧИТЕ** все настройки;
6. Запускайте игру с помощью файла `nhc.exe`.

> В некоторых случаях игре могут потребоваться права Администратора.

В итоге структура каталога игры должна выглядеть так:
- ddraw.dll
- nvhpatch.dll
- smackw32.dll
- NHC.exe
- readme.txt
- DATA\
  - A.BLB
  - C.BLB
  - HD.BLB
  - I.BLB
  - M.BLB
  - S.BLB
  - T.BLB

---

### Описание файлов патча

- `ddraw.dll`
  - исправляет проблемы с графикой и совместимостью;
  - подгружает `nvhpatch.dll`, если файл `nhc.exe` не пропатчен на работу с ним;
- `nvhpatch.dll`
  - осуществляет хранение игровых сохранений в виде файлов;
  - задает каталог поиска `BLB` файлов.

---

### Настройка параметров

Существет несколько параметров, которые могут быть настроены с помощью создания файлов в каталоге игры:

- файл `integer-scale.mode` - целочисленное масштабирование изображения в полноэкранном режиме;
- файл `disable-scale-filter.mode` - отключение билинейного фильтра масштабирования изображения в полноэкранном режиме;
- файл `scanlines.mode` - включение эффекта скан линий CRT телевизора в полноэкранном режиме;
- файл `windowed.mode` - оконный режим в оригинальном размере;
- файл `windowed2x.mode` - оконный режим в двойном размере.

---

### О проекте

Проект написан на **С++** с использованием **WinAPI**.

В проекте не используются стандартные библиотеки **C++**, в том числе и **CRT**.

Альтернативой **CRT** является минимальная реализация с набором необходимых функций, что уменьшило суммарный размер файлов патча до **20 килобайт**.

В качестве среды разработки используется `Visual Studio 2010`.

---

### О нас

- Программирование - **Константин Савенков** aka **`konst_s`** aka **`RangerKoc`**
- Тестирование, а так же идейный вдохновитель - **Максим Едуш** aka **`McSIM`**
